<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jan van der Laan" />
  <title>Record linkage using machine learning</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">
body {
max-width: 50rem;
margin-left: auto;
margin-right: auto;
font-family: system-ui;
color: lightgray;
background: #555555;
}
p, li {
text-align: justify;
}
pre {
background: #444;
padding: 0.5rem;
}
h1, h2, h3, h4, h5 {
color: orange;
font-weight: bold;
}
h4, h5 {
color: inherit;
}
h2 {
margin-top: 3rem;
}
a {
color: orange;
}
a:hover {
color: lightblue;
}
pre code {
color: white;
background: inherit;
padding: 0;
}
code {
color: #e5c892;
background: #444;
padding: 0.2rem;
}

p.author {
font-weight : bold;
color: orange;
}

code {
color : lightgray;
}
code span.op {
color: #cccccc;
}
code span.kw, code span.cf {
color: #30bd58;
}
code span.st {
color: #76a9db; }
code span.dv, code span.ot, code span.fl{
color: #7fd0a8; }
code span.dt, code span.er {
color: #ee8c70; }
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Record linkage using machine learning</h1>
<p class="author">Jan van der Laan</p>
</header>
<!--
%\VignetteEngine{simplermarkdown::mdweave_to_html}
%\VignetteIndexEntry{Record linkage using machine learning}
-->
<p>In this example we will show how <code>reclin2</code> can be used in combination with machine learning to perform record linkage. We will use the same example as in the introduction vignette and will skip over some of the initial steps in the linkage project. We will use plain logistic regression. Not the most sophisticated machine learning algorithm, but for the simplistic example more than enough. Other algorithms are easily substituted.</p>
<p>When performing record linkage, we will compare combinations of records from both datasets. After comparison we end up with a large dataset of pairs with properties of these pairs (the comparison vectors). The goal of record linkage is to divide these pairs into two groups: one group with pairs where both records in the pair belong to the same object, the matching set, and one group where both records in the pair do not belong to the same object, the unmatched set. Record linkage is, therefore, a classification problem and when we know for some of the pairs if they belong to the matching set or the unmatching set, we can use that to train a supervised classification method.</p>
<h1 id="generate-the-pairs-and-compare">Generate the pairs and compare</h1>
<p>First we have to generate all pairs and compare these. This is similar as in regular probabilistic linkage.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(reclin2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(<span class="st">&quot;linkexample1&quot;</span>, <span class="st">&quot;linkexample2&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(linkexample1)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  id lastname firstname    address sex postcode</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="dv">1</span>  <span class="dv">1</span>    Smith      Anna <span class="dv">12</span> Mainstr   F  <span class="dv">1234</span> AB</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="dv">2</span>  <span class="dv">2</span>    Smith    George <span class="dv">12</span> Mainstr   M  <span class="dv">1234</span> AB</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="dv">3</span>  <span class="dv">3</span>  Johnson      Anna <span class="dv">61</span> Mainstr   F  <span class="dv">1234</span> AB</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="dv">4</span>  <span class="dv">4</span>  Johnson   Charles <span class="dv">61</span> Mainstr   M  <span class="dv">1234</span> AB</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="dv">5</span>  <span class="dv">5</span>  Johnson    Charly <span class="dv">61</span> Mainstr   M  <span class="dv">1234</span> AB</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="dv">6</span>  <span class="dv">6</span> Schwartz       Ben  <span class="dv">1</span> Eaststr   M  <span class="dv">6789</span> XY</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(linkexample2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  id lastname firstname       address  sex postcode</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="dv">1</span>  <span class="dv">2</span>    Smith    Gearge <span class="dv">12</span> Mainstreet <span class="op">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">  </span><span class="dv">1234</span> AB</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a><span class="dv">2</span>  <span class="dv">3</span>   Jonson        A. <span class="dv">61</span> Mainstreet    F  <span class="dv">1234</span> AB</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a><span class="dv">3</span>  <span class="dv">4</span>  Johnson   Charles    <span class="dv">61</span> Mainstr    F  <span class="dv">1234</span> AB</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a><span class="dv">4</span>  <span class="dv">6</span> Schwartz       Ben        <span class="dv">1</span> Main    M  <span class="dv">6789</span> XY</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a><span class="dv">5</span>  <span class="dv">7</span> Schwartz      Anna     <span class="dv">1</span> Eaststr    F  <span class="dv">6789</span> XY</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">pair_blocking</span>(linkexample1, linkexample2, <span class="st">&quot;postcode&quot;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">compare_pairs</span>(pairs, <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;sex&quot;</span>), </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">inplace =</span> <span class="ot">TRUE</span>, <span class="dt">comparators =</span> <span class="kw">list</span>(<span class="dt">lastname =</span> <span class="kw">jaro_winkler</span>(), </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">firstname =</span> <span class="kw">jaro_winkler</span>(), <span class="dt">address =</span> <span class="kw">jaro_winkler</span>()))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>    .x .y lastname firstname   address   sex</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>    <span class="ot">NA</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span>  <span class="ot">TRUE</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span>  <span class="ot">TRUE</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>    <span class="ot">NA</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span> <span class="ot">FALSE</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span> <span class="ot">FALSE</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>    <span class="ot">NA</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span>  <span class="ot">TRUE</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span>  <span class="ot">TRUE</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>    <span class="ot">NA</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span> <span class="ot">FALSE</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span> <span class="ot">FALSE</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>    <span class="ot">NA</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span> <span class="ot">FALSE</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span> <span class="ot">FALSE</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span>  <span class="ot">TRUE</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span> <span class="ot">FALSE</span></span></code></pre></div>
<p>On of the things we run into, is that the variable <code>sex</code> has missing values. We could set these to <code>FALSE</code> (this is what is done when calling <code>problink_em</code> during estimation of the model), but with machine learning we could also include these as a separate category. For that we first need to define a custom comparison function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>na_as_class &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="kw">factor</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="op">+</span><span class="st">     </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(x) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(y), 2L, (y <span class="op">==</span><span class="st"> </span>x)<span class="op">*</span>1L),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="op">+</span><span class="st">     </span><span class="dt">levels =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;eq&quot;</span>, <span class="st">&quot;uneq&quot;</span>, <span class="st">&quot;mis&quot;</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
<p>We then remove the old variable <code>sex</code> (otherwise <code>compare_pairs</code> will complain that we cannot assign a factor to a logical vector) and compare the pairs again with the new comparison function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs[, sex <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>    .x .y lastname firstname   address</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">compare_pairs</span>(pairs, <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;sex&quot;</span>), </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">inplace =</span> <span class="ot">TRUE</span>, <span class="dt">comparators =</span> <span class="kw">list</span>(<span class="dt">lastname =</span> <span class="kw">jaro_winkler</span>(), </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">firstname =</span> <span class="kw">jaro_winkler</span>(), <span class="dt">address =</span> <span class="kw">jaro_winkler</span>(), <span class="dt">sex =</span> na_as_class))</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true"></a>    .x .y lastname firstname   address  sex</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  mis</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span> uneq</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span> uneq</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  mis</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   eq</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   eq</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  mis</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span> uneq</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span> uneq</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  mis</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   eq</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  mis</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   eq</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span> uneq</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   eq</span></code></pre></div>
<h1 id="estimate-the-model-and-use-the-model-to-classify-the-pairs">Estimate the model and use the model to classify the pairs</h1>
<p>In order to estimate the model we need some pairs for which we know the truth. One way of obtaining this information is by reviewing some of the pairs. The number of pairs will generally grow with <span class="math inline"><em>O</em>(<em>N</em><sup>2</sup>)</span> with <span class="math inline"><em>N</em></span> the size of the smallest dataset. The number of matches in these pairs is usually <span class="math inline"><em>O</em>(<em>N</em>)</span>. Therefore, the fraction of matches in the pairs is <span class="math inline"><em>O</em>(1/<em>N</em>)</span> and therefore usually very small. Therefore, when sampling records for review it is usually a good idea to not sample the pairs completely random, but, for example, oversample pairs that agree on more variables.</p>
<p>Another way of getting a training dataset is when additional information is available. For example, when linking a dataset to a population register for some of the records in the dataset an official id might be available. For these records the true match status can be determined. This is what we will simulate in the example below. Letâ€™s assume we know from three of the records in <code>linkexample2</code> the <code>id</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>linkexample2<span class="op">$</span>known_id &lt;-<span class="st"> </span>linkexample2<span class="op">$</span>id</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>linkexample2<span class="op">$</span>known_id[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">setDT</span>(linkexample2)</span></code></pre></div>
<p>We the know for these records the true match status in the pairs. Below we add this to the pairs:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">compare_vars</span>(pairs, <span class="st">&quot;y&quot;</span>, <span class="dt">on_x =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">on_y =</span> <span class="st">&quot;known_id&quot;</span>, <span class="dt">y =</span> linkexample2, <span class="dt">inplace =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Note that we supply <code>y = linkexample2</code> in the call. This is needed as the copy of <code>linkexample2</code> stored with <code>pairs</code> does not contain the <code>known_id</code> column. We can also add the true status for all records to measure the performance of the linkage in the end</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">compare_vars</span>(pairs, <span class="st">&quot;y_true&quot;</span>, <span class="dt">on_x =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">on_y =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">inplace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>    .x .y lastname firstname   address  sex     y y_true</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span> uneq    <span class="ot">NA</span>  <span class="ot">FALSE</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span> uneq <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  mis  <span class="ot">TRUE</span>   <span class="ot">TRUE</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   eq <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span> uneq    <span class="ot">NA</span>   <span class="ot">TRUE</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span> uneq <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   eq  <span class="ot">TRUE</span>   <span class="ot">TRUE</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   eq <span class="ot">FALSE</span>  <span class="ot">FALSE</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span> uneq  <span class="ot">TRUE</span>   <span class="ot">TRUE</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span></span></code></pre></div>
<p>We now have all of the information needed to estimate our (machine learning) model. Note that this will give a bunch of warnings as we estimating six parameters with only eleven observations and the parameters will not be reliably estimated.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>m &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>lastname <span class="op">+</span><span class="st"> </span>firstname <span class="op">+</span><span class="st"> </span>address <span class="op">+</span><span class="st"> </span>sex, <span class="dt">data =</span> pairs, <span class="dt">family =</span> <span class="kw">binomial</span>())</span></code></pre></div>
<p>And then we can add the prediction to <code>pairs</code> and check how well we have done:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs[, prob <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">predict</span>(m, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">newdata =</span> pairs)]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>    .x .y lastname firstname   address  sex     y y_true         prob</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span> uneq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">1.000000e+00</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span> uneq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">7.317210e-12</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  mis  <span class="ot">TRUE</span>   <span class="ot">TRUE</span> <span class="fl">1.000000e+00</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   eq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span> uneq    <span class="ot">NA</span>   <span class="ot">TRUE</span> <span class="fl">2.214629e-12</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span> uneq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">1.665098e-11</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   eq  <span class="ot">TRUE</span>   <span class="ot">TRUE</span> <span class="fl">1.000000e+00</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   eq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">4.477438e-11</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span> uneq  <span class="ot">TRUE</span>   <span class="ot">TRUE</span> <span class="fl">1.000000e+00</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs[, select <span class="op">:</span><span class="er">=</span><span class="st"> </span>prob <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>]</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true"></a>    .x .y lastname firstname   address  sex     y y_true         prob select</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span> uneq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">1.000000e+00</span>   <span class="ot">TRUE</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span> uneq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">7.317210e-12</span>  <span class="ot">FALSE</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  mis  <span class="ot">TRUE</span>   <span class="ot">TRUE</span> <span class="fl">1.000000e+00</span>   <span class="ot">TRUE</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   eq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span> uneq    <span class="ot">NA</span>   <span class="ot">TRUE</span> <span class="fl">2.214629e-12</span>  <span class="ot">FALSE</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span> uneq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">1.665098e-11</span>  <span class="ot">FALSE</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   eq  <span class="ot">TRUE</span>   <span class="ot">TRUE</span> <span class="fl">1.000000e+00</span>   <span class="ot">TRUE</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  mis <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   eq <span class="ot">FALSE</span>  <span class="ot">FALSE</span> <span class="fl">4.477438e-11</span>  <span class="ot">FALSE</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span> uneq  <span class="ot">TRUE</span>   <span class="ot">TRUE</span> <span class="fl">1.000000e+00</span>   <span class="ot">TRUE</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   eq    <span class="ot">NA</span>  <span class="ot">FALSE</span> <span class="fl">2.220446e-16</span>  <span class="ot">FALSE</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(pairs<span class="op">$</span>select <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, pairs<span class="op">$</span>y_true)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true"></a>       </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true"></a>        <span class="ot">FALSE</span> <span class="ot">TRUE</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true"></a>  <span class="ot">FALSE</span>    <span class="dv">12</span>    <span class="dv">1</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true"></a>  <span class="ot">TRUE</span>      <span class="dv">1</span>    <span class="dv">3</span></span></code></pre></div>
<p>Given the small size of the dataset we have to estimate the model on, this is not too bad.</p>
<h1 id="create-the-linked-data-set">Create the linked data set</h1>
<p>We now know which pairs are to be linked, but we still have to actually link them. <code>link</code> does that (the optional arguments <code>all_x</code> and <code>all_y</code> control the type of linkage):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>linked_data_set &lt;-<span class="st"> </span><span class="kw">link</span>(pairs, <span class="dt">selection =</span> <span class="st">&quot;select&quot;</span>, <span class="dt">all_y =</span> <span class="ot">TRUE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(linked_data_set)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">5</span> pairs</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>   .y .x id.x lastname.x firstname.x  address.x sex.x postcode.x id.y</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a><span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span>    <span class="dv">2</span>      Smith      George <span class="dv">12</span> Mainstr     M    <span class="dv">1234</span> AB    <span class="dv">2</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a><span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span>    <span class="dv">1</span>      Smith        Anna <span class="dv">12</span> Mainstr     F    <span class="dv">1234</span> AB    <span class="dv">3</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a><span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">4</span>    <span class="dv">4</span>    Johnson     Charles <span class="dv">61</span> Mainstr     M    <span class="dv">1234</span> AB    <span class="dv">4</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a><span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">6</span>    <span class="dv">6</span>   Schwartz         Ben  <span class="dv">1</span> Eaststr     M    <span class="dv">6789</span> XY    <span class="dv">6</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a><span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span> <span class="ot">NA</span>   <span class="ot">NA</span>       <span class="op">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">        </span><span class="er">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">    </span><span class="dv">7</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>   lastname.y firstname.y     address.y sex.y postcode.y</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a><span class="dv">1</span><span class="op">:</span><span class="st">      </span>Smith      Gearge <span class="dv">12</span> Mainstreet  <span class="op">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">    </span><span class="dv">1234</span> AB</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a><span class="dv">2</span><span class="op">:</span><span class="st">     </span>Jonson          A. <span class="dv">61</span> Mainstreet     F    <span class="dv">1234</span> AB</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a><span class="dv">3</span><span class="op">:</span><span class="st">    </span>Johnson     Charles    <span class="dv">61</span> Mainstr     F    <span class="dv">1234</span> AB</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a><span class="dv">4</span><span class="op">:</span><span class="st">   </span>Schwartz         Ben        <span class="dv">1</span> Main     M    <span class="dv">6789</span> XY</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a><span class="dv">5</span><span class="op">:</span><span class="st">   </span>Schwartz        Anna     <span class="dv">1</span> Eaststr     F    <span class="dv">6789</span> XY</span></code></pre></div>
</body>
</html>
