<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jan van der Laan" />
  <title>Introduction to reclin2</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">
body {
max-width: 50rem;
margin-left: auto;
margin-right: auto;
font-family: system-ui;
color: lightgray;
background: #555555;
}
p, li {
text-align: justify;
}
pre {
background: #444;
padding: 0.5rem;
}
h1, h2, h3, h4, h5 {
color: orange;
font-weight: bold;
}
h4, h5 {
color: inherit;
}
h2 {
margin-top: 3rem;
}
a {
color: orange;
}
a:hover {
color: lightblue;
}
pre code {
color: white;
background: inherit;
padding: 0;
}
code {
color: #e5c892;
background: #444;
padding: 0.2rem;
}

p.author {
font-weight : bold;
color: orange;
}

code {
color : lightgray;
}
code span.op {
color: #cccccc;
}
code span.kw, code span.cf {
color: #30bd58;
}
code span.st {
color: #76a9db; }
code span.dv, code span.ot, code span.fl{
color: #7fd0a8; }
code span.dt, code span.er {
color: #ee8c70; }
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Introduction to reclin2</h1>
<p class="author">Jan van der Laan</p>
</header>
<!--
%\VignetteEngine{simplermarkdown::mdweave_to_html}
%\VignetteIndexEntry{Introduction to reclin2}
-->
<h2 id="introduction">Introduction</h2>
<p><code>reclin2</code> implements methodology for linking records based on inexact keys. It allows for maximum flexibility by giving users full control over each step of the linking procedure. The package is built with performance and scalability in mind: the core algorithms have been implemented in <code>C++</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(reclin2)</span></code></pre></div>
<p>We will work with a pair of data sets with artificial data. They are tiny, but that allows us to see what happens. In this example we will perform ‘classic’ probabilistic record linkage. When some known true links are known it is also possible to use machine learning methods. This is illustrated in another vignette.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(<span class="st">&quot;linkexample1&quot;</span>, <span class="st">&quot;linkexample2&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(linkexample1)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  id lastname firstname    address sex postcode</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="dv">1</span>  <span class="dv">1</span>    Smith      Anna <span class="dv">12</span> Mainstr   F  <span class="dv">1234</span> AB</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="dv">2</span>  <span class="dv">2</span>    Smith    George <span class="dv">12</span> Mainstr   M  <span class="dv">1234</span> AB</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="dv">3</span>  <span class="dv">3</span>  Johnson      Anna <span class="dv">61</span> Mainstr   F  <span class="dv">1234</span> AB</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="dv">4</span>  <span class="dv">4</span>  Johnson   Charles <span class="dv">61</span> Mainstr   M  <span class="dv">1234</span> AB</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="dv">5</span>  <span class="dv">5</span>  Johnson    Charly <span class="dv">61</span> Mainstr   M  <span class="dv">1234</span> AB</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="dv">6</span>  <span class="dv">6</span> Schwartz       Ben  <span class="dv">1</span> Eaststr   M  <span class="dv">6789</span> XY</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(linkexample2)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>  id lastname firstname       address  sex postcode</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="dv">1</span>  <span class="dv">2</span>    Smith    Gearge <span class="dv">12</span> Mainstreet <span class="op">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">  </span><span class="dv">1234</span> AB</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="dv">2</span>  <span class="dv">3</span>   Jonson        A. <span class="dv">61</span> Mainstreet    F  <span class="dv">1234</span> AB</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="dv">3</span>  <span class="dv">4</span>  Johnson   Charles    <span class="dv">61</span> Mainstr    F  <span class="dv">1234</span> AB</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a><span class="dv">4</span>  <span class="dv">6</span> Schwartz       Ben        <span class="dv">1</span> Main    M  <span class="dv">6789</span> XY</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a><span class="dv">5</span>  <span class="dv">7</span> Schwartz      Anna     <span class="dv">1</span> Eaststr    F  <span class="dv">6789</span> XY</span></code></pre></div>
<p>We have two data sets with personal information. The second data set contains a lot of errors, but we will try to link the second data set to the first.</p>
<h2 id="step-1-generate-pairs">Step 1: generate pairs</h2>
<p>In principle linkage consists of comparing each combination of records from the two data sets and determine which of those combinations (or pairs as we will call them below) belong to the same entity. In case of a perfect linkage key, it is of course, not necessary to compare all combinations of records, but when the linkage keys are imperfect and contain errors, it is in principle necessary to compare all pairs.</p>
<p>However, comparing all pairs can result in an intractable number of pairs: when linking two data sets with a million records there are <span class="math inline">10<sup>12</sup></span> possible pairs. Therefore, some sort of reduction of the possible pairs is usually applied. In the example below, we apply <em>blocking</em>, which means that pairs are only generated when they agree on the blocking variable (in this case the postcode). This means that pairs of records that disagree on the blocking variable are not considered. Therefore, one will only use variables that can be considered without errors as blocking variable, or link multiple times with different blocking variables and combine both data sets.</p>
<p>The first step in (probabilistic) linkage is, therefore, generating all pairs:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">pair_blocking</span>(linkexample1, linkexample2, <span class="st">&quot;postcode&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    .x .y</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span></span></code></pre></div>
<p>As you can see, record 1 from <code>x</code> (the first data set) is compared to records 1, 2 and 3 from <code>y</code>. Also note that <code>reclin2</code> uses the <code>data.table</code> package to efficiently perform some of the computations. Therefore, the <code>pairs</code> object is a <code>data.table</code>.</p>
<p>Other functions to generate pairs are:</p>
<ul>
<li><code>pair</code>: generate all possible pairs</li>
<li><code>pairs_minsim</code>: generate pairs that have minimum similarity score (e.g. should agree on at least one variable in a set of given variables). Can be computationally intensive as all records have to be compared.</li>
</ul>
<h2 id="step-2-compare-pairs">Step 2: compare pairs</h2>
<p>We can now compare the records on their linkage keys:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">compare_pairs</span>(pairs, <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;sex&quot;</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    .x .y lastname firstname address   sex</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>    <span class="ot">TRUE</span>  <span class="ot">TRUE</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span>     <span class="ot">TRUE</span>      <span class="ot">TRUE</span>    <span class="ot">TRUE</span> <span class="ot">FALSE</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>    <span class="ot">TRUE</span> <span class="ot">FALSE</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span>     <span class="ot">TRUE</span>      <span class="ot">TRUE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>    <span class="ot">TRUE</span> <span class="ot">FALSE</span></span></code></pre></div>
<p>As you can see, we don’t need to pass the original data sets although the variables <code>lastname</code> etc. are from those original data sets. This is because a copy of the original data sets are stored with the pairs object <code>pairs</code> (and should you be worrying about memory: as long as the original data sets are not modified the data sets are not actually copied).</p>
<p>In the example above the result of <code>compare_pairs</code> was assigned back to <code>pairs</code>. When working with large datasets it can be more efficient to modify <code>pairs</code> in place preventing unnecessary copies. This behaviour can be switched on using the <code>inplace</code> argument which is accepted by most functions.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">compare_pairs</span>(pairs, <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;sex&quot;</span>), </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">inplace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>    .x .y lastname firstname address   sex</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>    <span class="ot">TRUE</span>  <span class="ot">TRUE</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span>     <span class="ot">TRUE</span>      <span class="ot">TRUE</span>    <span class="ot">TRUE</span> <span class="ot">FALSE</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span>    <span class="ot">NA</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span>    <span class="ot">FALSE</span>     <span class="ot">FALSE</span>   <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>    <span class="ot">TRUE</span> <span class="ot">FALSE</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span>     <span class="ot">TRUE</span>      <span class="ot">TRUE</span>   <span class="ot">FALSE</span>  <span class="ot">TRUE</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span>     <span class="ot">TRUE</span>     <span class="ot">FALSE</span>    <span class="ot">TRUE</span> <span class="ot">FALSE</span></span></code></pre></div>
<p>The default comparison function returns <code>TRUE</code> when the linkage keys agree and false when they don’t. However, when looking at the original data sets, we can see that most of our linkage keys are string variables that contain typing errors. The quality of our linkage could be improved if we could use a similarity score to compare the two strings: a high score means that the two strings are very similar a value close to zero means that the strings are very different.</p>
<p>Below we use the <code>cmp_jarowinkler</code> similarity score to compare all fields:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">compare_pairs</span>(pairs, <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;sex&quot;</span>),</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">default_comparator =</span> <span class="kw">cmp_jarowinkler</span>(<span class="fl">0.9</span>), <span class="dt">inplace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>    .x .y lastname firstname   address sex</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span>   <span class="dv">1</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span>   <span class="dv">1</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   <span class="dv">0</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   <span class="dv">0</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span>   <span class="dv">1</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span>   <span class="dv">1</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   <span class="dv">0</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   <span class="dv">0</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span>   <span class="dv">1</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   <span class="dv">0</span></span></code></pre></div>
<p>The function <code>compare_vars</code> offers more flexibility than <code>compare_pairs</code>. It can for example compare multiple variables at the same time (e.g. compare birth day and month allowing for swaps) or generate multiple results from comparing on one variable.</p>
<h2 id="step-3-score-pairs">Step 3: score pairs</h2>
<p>The next step in the process, is to determine which pairs of records belong to the same entity and which do not. There are numerous ways to do this. One possibility is to label some of the pairs as match or no match, and use some machine learning algorithm to predict the match status using the comparison vectors. Traditionally, the probabilistic linkage framework initially formalised by Fellegi and Sunter tries is used. The function <code>problink_em</code> uses an EM-algorithm to estimate the so called m- and u-probabilities for each of the linkage variables. The m-probability is the probability that two records concerning the same entity agree on the linkage variable; this means that the m-probability corresponds to the probability that there is an error in the linkage variables. The u-probability is the probability that two records belonging to different entities agree on a variable. For a variable with few categories (such as sex) this probability will be large, while for a variable with a large number of categories (such as last name) this probability will be small.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>m &lt;-<span class="st"> </span><span class="kw">problink_em</span>(<span class="op">~</span><span class="st"> </span>lastname <span class="op">+</span><span class="st"> </span>firstname <span class="op">+</span><span class="st"> </span>address <span class="op">+</span><span class="st"> </span>sex, <span class="dt">data =</span> pairs)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(m)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>M<span class="op">-</span><span class="st"> </span>and u<span class="op">-</span>probabilities estimated by the EM<span class="op">-</span>algorithm<span class="op">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="st">  </span>Variable M<span class="op">-</span>probability U<span class="op">-</span>probability</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>  lastname     <span class="fl">0.9990000</span>   <span class="fl">0.001152679</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a> firstname     <span class="fl">0.1999999</span>   <span class="fl">0.000100000</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>   address     <span class="fl">0.8999206</span>   <span class="fl">0.285831118</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>       sex     <span class="fl">0.3002011</span>   <span class="fl">0.285427112</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>Matching probability<span class="op">:</span><span class="st"> </span><span class="dv">0</span>.<span class="fl">5885595.</span></span></code></pre></div>
<p>These m- and u-probabilities can be used to score the pairs:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">predict</span>(m, <span class="dt">pairs =</span> pairs, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>    .x .y lastname firstname   address sex    weights</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span>  <span class="fl">7.7103862</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span>   <span class="dv">1</span> <span class="fl">-5.9463949</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span>   <span class="dv">1</span>  <span class="fl">0.8042090</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span>  <span class="fl">8.6064218</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   <span class="dv">0</span> <span class="fl">-6.3177171</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   <span class="dv">0</span>  <span class="fl">0.7937508</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.6017106</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span>   <span class="dv">1</span>  <span class="fl">4.0674910</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span>   <span class="dv">1</span>  <span class="fl">7.9350221</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.7713174</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span>  <span class="fl">3.6961688</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   <span class="dv">0</span> <span class="fl">15.4915816</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.6717426</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span>  <span class="fl">3.6961688</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   <span class="dv">0</span>  <span class="fl">8.5458257</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span>   <span class="dv">1</span> <span class="fl">14.6796595</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   <span class="dv">0</span>  <span class="fl">7.9139248</span></span></code></pre></div>
<p>With <code>add = TRUE</code> the predictions are added to the <code>pairs</code> object. The higher the weight the more likely the two pairs belong to the same entity/are a match.</p>
<p>The prediction function can also return the m- and u-probabilities and the posterior m- and u-probabilities.</p>
<p>A simpler method is to base the score directly on the similarity scores by calculating a (weighted) sum of the similarity scores. The higher the score the more similar the two records in the pair are. In the simplest case <code>score_simple</code> just calculates the sum of the similarity scores of the compared variables:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">score_simple</span>(pairs, <span class="st">&quot;score&quot;</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;sex&quot;</span>))</span></code></pre></div>
<p>However, it is also possible to provide custom weights for each of the variables. In that way some variables can contribute more or less to the final score. For example, agreement on last name might give more information than agreement on a variable such as sex.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">score_simple</span>(pairs, <span class="st">&quot;score&quot;</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;sex&quot;</span>), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">w1 =</span> <span class="kw">c</span>(<span class="dt">lastname =</span> <span class="dv">2</span>, <span class="dt">firstname =</span> <span class="dv">2</span>, <span class="dt">address =</span> <span class="dv">1</span>, <span class="dt">sex =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">w0 =</span> <span class="dv">-1</span>, <span class="dt">wna =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Using <code>w1</code>, <code>w0</code> and <code>wna</code> it is possible to specify separate weights for agreement, non-agreement and missing values respectively. For example, agreement on last name might be a strong indication that two records belong to the same object, while non-agreement on last name might not be strong indication of two records not being from the same object as last name might contain a lot of errors. In that case a high values for <code>w1</code> and a hight (e.g. only slightly negative) values for <code>w0</code> might be appropriate. For sex the reverse might be true: agreement does not give much information (as two random persons will generally have a 50 percent chance of having the same sec) while non-agreement might be a strong indication that the two records do not belong to the same person (e.g. when there are few errors in sex). In that case relatively low values for <code>w1</code> and low values for <code>w0</code> are appropriate.</p>
<p>The total contribution of the comparison <span class="math inline"><em>c</em><sub><em>i</em></sub></span> of variable <span class="math inline"><em>i</em></span> is</p>
<p><br /><span class="math display"><em>w</em><sub><em>i</em></sub> = <em>w</em><sub>1, <em>i</em></sub><em>c</em><sub><em>i</em></sub> + <em>w</em><sub>0, <em>i</em></sub>(1 − <em>c</em><sub><em>i</em></sub>)</span><br /></p>
<p>Or <code>wna</code> when the comparison is missing. This assumes that similarity scores are between zero and one.</p>
<h2 id="step-4-select-pairs">Step 4: select pairs</h2>
<p>The final step is to select the pairs that are considered to belong to the same entities. The simplest method is to select all pairs above a certain threshold</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">select_threshold</span>(pairs, <span class="st">&quot;threshold&quot;</span>, <span class="dt">score =</span> <span class="st">&quot;weights&quot;</span>, <span class="dt">threshold =</span> <span class="dv">8</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>    .x .y lastname firstname   address sex    weights      score threshold</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span>  <span class="fl">7.7103862</span>  <span class="fl">3.2628205</span>     <span class="ot">FALSE</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span>   <span class="dv">1</span> <span class="fl">-5.9463949</span>  <span class="fl">0.9782051</span>     <span class="ot">FALSE</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span>   <span class="dv">1</span>  <span class="fl">0.8042090</span>  <span class="fl">2.1023810</span>     <span class="ot">FALSE</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span>  <span class="fl">8.6064218</span>  <span class="fl">4.5128205</span>      <span class="ot">TRUE</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   <span class="dv">0</span> <span class="fl">-6.3177171</span> <span class="fl">-2.2717949</span>     <span class="ot">FALSE</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   <span class="dv">0</span>  <span class="fl">0.7937508</span>  <span class="fl">0.8285714</span>     <span class="ot">FALSE</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.6017106</span>  <span class="fl">1.4877289</span>     <span class="ot">FALSE</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span>   <span class="dv">1</span>  <span class="fl">4.0674910</span>  <span class="fl">3.9532967</span>     <span class="ot">FALSE</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span>   <span class="dv">1</span>  <span class="fl">7.9350221</span>  <span class="fl">3.8928571</span>     <span class="ot">FALSE</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.7713174</span>  <span class="fl">1.9996337</span>     <span class="ot">FALSE</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span>  <span class="fl">3.6961688</span>  <span class="fl">0.7032967</span>     <span class="ot">FALSE</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   <span class="dv">0</span> <span class="fl">15.4915816</span>  <span class="fl">4.0000000</span>      <span class="ot">TRUE</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.6717426</span>  <span class="fl">1.7377289</span>     <span class="ot">FALSE</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span>  <span class="fl">3.6961688</span>  <span class="fl">0.7032967</span>     <span class="ot">FALSE</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   <span class="dv">0</span>  <span class="fl">8.5458257</span>  <span class="fl">3.5476190</span>      <span class="ot">TRUE</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span>   <span class="dv">1</span> <span class="fl">14.6796595</span>  <span class="fl">4.7222222</span>      <span class="ot">TRUE</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   <span class="dv">0</span>  <span class="fl">7.9139248</span>  <span class="fl">2.5833333</span>     <span class="ot">FALSE</span></span></code></pre></div>
<p>The select functions add a (logical) variable to the data set indicating whether a pairs is selected or not.</p>
<p>In this case we know which records truly belong to each other. We can use that to evaluate the linkage:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">compare_vars</span>(pairs, <span class="st">&quot;truth&quot;</span>, <span class="dt">on_x =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">on_y =</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(pairs)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>  First data set<span class="op">:</span><span class="st">  </span><span class="dv">6</span> records</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>  Second data set<span class="op">:</span><span class="st"> </span><span class="dv">5</span> records</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">17</span> pairs</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>  Blocking on<span class="op">:</span><span class="st"> &#39;postcode&#39;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>    .x .y lastname firstname   address sex    weights      score threshold</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.4722222</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span>  <span class="fl">7.7103862</span>  <span class="fl">3.2628205</span>     <span class="ot">FALSE</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.5833333</span> <span class="fl">0.8641026</span>   <span class="dv">1</span> <span class="fl">-5.9463949</span>  <span class="fl">0.9782051</span>     <span class="ot">FALSE</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.4642857</span> <span class="fl">0.9333333</span>   <span class="dv">1</span>  <span class="fl">0.8042090</span>  <span class="fl">2.1023810</span>     <span class="ot">FALSE</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">1</span> <span class="fl">1.000000</span> <span class="fl">0.8888889</span> <span class="fl">0.9230769</span>  <span class="ot">NA</span>  <span class="fl">8.6064218</span>  <span class="fl">4.5128205</span>      <span class="ot">TRUE</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">0.000000</span> <span class="fl">0.0000000</span> <span class="fl">0.8641026</span>   <span class="dv">0</span> <span class="fl">-6.3177171</span> <span class="fl">-2.2717949</span>     <span class="ot">FALSE</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span> <span class="fl">0.447619</span> <span class="fl">0.5396825</span> <span class="fl">0.9333333</span>   <span class="dv">0</span>  <span class="fl">0.7937508</span>  <span class="fl">0.8285714</span>     <span class="ot">FALSE</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.4722222</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.6017106</span>  <span class="fl">1.4877289</span>     <span class="ot">FALSE</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.5833333</span> <span class="fl">0.9230769</span>   <span class="dv">1</span>  <span class="fl">4.0674910</span>  <span class="fl">3.9532967</span>     <span class="ot">FALSE</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.4642857</span> <span class="fl">1.0000000</span>   <span class="dv">1</span>  <span class="fl">7.9350221</span>  <span class="fl">3.8928571</span>     <span class="ot">FALSE</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.6428571</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.7713174</span>  <span class="fl">1.9996337</span>     <span class="ot">FALSE</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span>  <span class="fl">3.6961688</span>  <span class="fl">0.7032967</span>     <span class="ot">FALSE</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">1.0000000</span>   <span class="dv">0</span> <span class="fl">15.4915816</span>  <span class="fl">4.0000000</span>      <span class="ot">TRUE</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.447619</span> <span class="fl">0.5555556</span> <span class="fl">0.8641026</span>  <span class="ot">NA</span>  <span class="fl">0.6717426</span>  <span class="fl">1.7377289</span>     <span class="ot">FALSE</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">0.952381</span> <span class="fl">0.0000000</span> <span class="fl">0.9230769</span>   <span class="dv">0</span>  <span class="fl">3.6961688</span>  <span class="fl">0.7032967</span>     <span class="ot">FALSE</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st">  </span><span class="dv">5</span>  <span class="dv">3</span> <span class="fl">1.000000</span> <span class="fl">0.8492063</span> <span class="fl">1.0000000</span>   <span class="dv">0</span>  <span class="fl">8.5458257</span>  <span class="fl">3.5476190</span>      <span class="ot">TRUE</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">4</span> <span class="fl">1.000000</span> <span class="fl">1.0000000</span> <span class="fl">0.6111111</span>   <span class="dv">1</span> <span class="fl">14.6796595</span>  <span class="fl">4.7222222</span>      <span class="ot">TRUE</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">5</span> <span class="fl">1.000000</span> <span class="fl">0.5277778</span> <span class="fl">1.0000000</span>   <span class="dv">0</span>  <span class="fl">7.9139248</span>  <span class="fl">2.5833333</span>     <span class="ot">FALSE</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a>    truth</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a> <span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a> <span class="dv">2</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a> <span class="dv">3</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a> <span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="ot">TRUE</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a> <span class="dv">5</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a> <span class="dv">6</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a> <span class="dv">7</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true"></a> <span class="dv">8</span><span class="op">:</span><span class="st">  </span><span class="ot">TRUE</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true"></a> <span class="dv">9</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true"></a><span class="dv">10</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true"></a><span class="dv">11</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true"></a><span class="dv">12</span><span class="op">:</span><span class="st">  </span><span class="ot">TRUE</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true"></a><span class="dv">13</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true"></a><span class="dv">14</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true"></a><span class="dv">15</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true"></a><span class="dv">16</span><span class="op">:</span><span class="st">  </span><span class="ot">TRUE</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true"></a><span class="dv">17</span><span class="op">:</span><span class="st"> </span><span class="ot">FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(pairs<span class="op">$</span>truth, pairs<span class="op">$</span>threshold)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>       </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>        <span class="ot">FALSE</span> <span class="ot">TRUE</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>  <span class="ot">FALSE</span>    <span class="dv">12</span>    <span class="dv">1</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>  <span class="ot">TRUE</span>      <span class="dv">1</span>    <span class="dv">3</span></span></code></pre></div>
<p>We see that three of the four matches that should have been found have indeed been found (the recall is 3/4) and we have one false link (sensitivity is 1/4).</p>
<p>Using a threshold, does not take into account the fact that often we know that one record from the first data set can be linked to at most one record from the second data set and vice versa. If we make the threshold low enough we have more links than records in either data set. <code>reclin</code> contains two functions that force one-to-one linkage: <code>select_greedy</code> and <code>select_n_to_m</code>. The first is fast (it selects pairs starting from the highest score; pairs are only selected when each of the records in a pair have not been selected previously); the second is slower, but can lead to better results (it tries to optimise to total score of the selected records under the restriction that each record can be selected only once):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">select_greedy</span>(pairs, <span class="st">&quot;weights&quot;</span>, <span class="dt">variable =</span> <span class="st">&quot;greedy&quot;</span>, <span class="dt">threshold =</span> <span class="dv">0</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(pairs<span class="op">$</span>truth, pairs<span class="op">$</span>greedy)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>       </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>        <span class="ot">FALSE</span> <span class="ot">TRUE</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>  <span class="ot">FALSE</span>    <span class="dv">13</span>    <span class="dv">0</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>  <span class="ot">TRUE</span>      <span class="dv">0</span>    <span class="dv">4</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>pairs &lt;-<span class="st"> </span><span class="kw">select_n_to_m</span>(pairs, <span class="st">&quot;weights&quot;</span>, <span class="dt">variable =</span> <span class="st">&quot;ntom&quot;</span>, <span class="dt">threshold =</span> <span class="dv">0</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(pairs<span class="op">$</span>truth, pairs<span class="op">$</span>ntom)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>       </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>        <span class="ot">FALSE</span> <span class="ot">TRUE</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>  <span class="ot">FALSE</span>    <span class="dv">13</span>    <span class="dv">0</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>  <span class="ot">TRUE</span>      <span class="dv">0</span>    <span class="dv">4</span></span></code></pre></div>
<p>Perfection!</p>
<p>Other functions to select pairs are</p>
<ul>
<li><code>select_unique</code> which will deselect pairs that are matched multiple times.</li>
</ul>
<h2 id="the-final-last-step">The final, last step</h2>
<p>The real final step is to create the linked data set. We now know which pairs are to be linked, but we still have to actually link them. <code>link</code> does that (the optional arguments <code>all_x</code> and <code>all_y</code> control the type of linkage):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>linked_data_set &lt;-<span class="st"> </span><span class="kw">link</span>(pairs, <span class="dt">selection =</span> <span class="st">&quot;ntom&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(linked_data_set)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>  Total number of pairs<span class="op">:</span><span class="st"> </span><span class="dv">4</span> pairs</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>   .y .x id.x lastname.x firstname.x  address.x sex.x postcode.x id.y</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a><span class="dv">1</span><span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span>    <span class="dv">2</span>      Smith      George <span class="dv">12</span> Mainstr     M    <span class="dv">1234</span> AB    <span class="dv">2</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a><span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="dv">2</span>  <span class="dv">3</span>    <span class="dv">3</span>    Johnson        Anna <span class="dv">61</span> Mainstr     F    <span class="dv">1234</span> AB    <span class="dv">3</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a><span class="dv">3</span><span class="op">:</span><span class="st">  </span><span class="dv">3</span>  <span class="dv">4</span>    <span class="dv">4</span>    Johnson     Charles <span class="dv">61</span> Mainstr     M    <span class="dv">1234</span> AB    <span class="dv">4</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a><span class="dv">4</span><span class="op">:</span><span class="st">  </span><span class="dv">4</span>  <span class="dv">6</span>    <span class="dv">6</span>   Schwartz         Ben  <span class="dv">1</span> Eaststr     M    <span class="dv">6789</span> XY    <span class="dv">6</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>   lastname.y firstname.y     address.y sex.y postcode.y</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true"></a><span class="dv">1</span><span class="op">:</span><span class="st">      </span>Smith      Gearge <span class="dv">12</span> Mainstreet  <span class="op">&lt;</span><span class="ot">NA</span><span class="op">&gt;</span><span class="st">    </span><span class="dv">1234</span> AB</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true"></a><span class="dv">2</span><span class="op">:</span><span class="st">     </span>Jonson          A. <span class="dv">61</span> Mainstreet     F    <span class="dv">1234</span> AB</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true"></a><span class="dv">3</span><span class="op">:</span><span class="st">    </span>Johnson     Charles    <span class="dv">61</span> Mainstr     F    <span class="dv">1234</span> AB</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true"></a><span class="dv">4</span><span class="op">:</span><span class="st">   </span>Schwartz         Ben        <span class="dv">1</span> Main     M    <span class="dv">6789</span> XY</span></code></pre></div>
</body>
</html>
